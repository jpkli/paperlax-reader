(function(e){function t(t){for(var r,a,o=t[0],l=t[1],c=t[2],d=0,h=[];d<o.length;d++)a=o[d],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&h.push(n[a][0]),n[a]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(h.length)h.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],r=!0,a=1;a<i.length;a++){var l=i[a];0!==n[l]&&(r=!1)}r&&(s.splice(t--,1),e=o(o.s=i[0]))}return e}var r={},n={app:0},s=[];function a(e){return o.p+"js/"+({pdfjsWorker:"pdfjsWorker"}[e]||e)+"."+{pdfjsWorker:"54d3daa0"}[e]+".js"}function o(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(e){var t=[],i=n[e];if(0!==i)if(i)t.push(i[2]);else{var r=new Promise(function(t,r){i=n[e]=[t,r]});t.push(i[2]=r);var s,l=document.createElement("script");l.charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.src=a(e);var c=new Error;s=function(t){l.onerror=l.onload=null,clearTimeout(d);var i=n[e];if(0!==i){if(i){var r=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",c.name="ChunkLoadError",c.type=r,c.request=s,i[1](c)}n[e]=void 0}};var d=setTimeout(function(){s({type:"timeout",target:l})},12e4);l.onerror=l.onload=s,document.head.appendChild(l)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/paperlax-reader/",o.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var u=c;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"034f":function(e,t,i){"use strict";var r=i("1356"),n=i.n(r);n.a},"07df":function(e,t,i){},"0895":function(e,t,i){e.exports=i.p+"img/google.1cdc8fce.svg"},"0b03":function(e,t,i){"use strict";var r=i("726f"),n=i.n(r);n.a},1:function(e,t){},1356:function(e,t,i){},1771:function(e,t,i){var r={"./google.png":"cebc","./google.svg":"0895","./logo.svg":"9b19","./style.css":"7d05"};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=s,e.exports=n,n.id="1771"},2:function(e,t){},2456:function(e,t,i){},2487:function(e,t,i){},"2e57":function(e,t,i){"use strict";var r=i("07df"),n=i.n(r);n.a},3:function(e,t){},"352d":function(e,t,i){"use strict";var r=i("2456"),n=i.n(r);n.a},"372b":function(e,t,i){"use strict";var r=i("b224"),n=i.n(r);n.a},"3c0f":function(e,t,i){"use strict";var r=i("a5cb"),n=i.n(r);n.a},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,i){"use strict";i.r(t);var r=i("2b0e"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},s=[],a={name:"App"},o=a,l=(i("034f"),i("2877")),c=Object(l["a"])(o,n,s,!1,null,null,null),d=c.exports,u=i("8c4f"),h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-content",[r("v-container",{staticClass:"fill-height",attrs:{fluid:""}},[r("v-row",{attrs:{align:"center",justify:"center"}},[r("v-col",{attrs:{cols:"12",sm:"8",md:"4"}},[r("v-card",{staticClass:"pa-5"},[r("div",{staticClass:"ma-10"},[r("h1",[e._v("PaperLax")]),r("h3",[e._v("Sign in to enjoy all features")])]),e.showUI?e._e():r("div",{staticStyle:{"margin-top":"20%"}},[r("h2",[e._v("Signing in")]),r("v-progress-circular",{staticClass:"ma-5 pa-5",attrs:{width:5,size:100,color:"blue",indeterminate:""}}),r("h2",[e._v("Explore and Discover")]),r("h3",[e._v("by standing on the shoulders of giants")])],1),e.isSignedIn?e._e():r("div",{class:{hidden:!e.showUI}},[r("div",e._l(e.OauthProviders,function(t,n){return r("div",{key:n,attrs:{xs12:""}},[r("button",{staticClass:"signin-button",style:{"background-color":t.backgroundColor,color:t.textColor},on:{click:function(i){return e.signIn(t.provider)}}},[t.image?r("img",{staticClass:"button-icon",attrs:{width:"24",src:i("1771")("./"+t.image)}}):r("i",{staticClass:"button-icon",class:t.icon,style:{color:t.iconColor}}),r("div",[e._v("Sign in with "+e._s(t.name))])])])}),0),r("div",{staticClass:"strike"},[r("span",[e._v("or")])]),r("div",[r("div",{staticClass:"email-form"},[r("div",[r("label",[e._v("Email")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],attrs:{type:"text",label:"Email*"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),r("div",[r("label",[e._v("Password")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",label:"Password*"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})])]),r("div",[r("div",{staticClass:"pa-5"},[r("v-btn",{staticClass:"signin-button",on:{click:function(t){return e.signIn()}}},[e._v("\n                      Sign in with Email\n                    ")])],1)])])])])],1)],1)],1)],1)],1)},p=[],f=i("59ca");i("ea7b");f["auth"].EmailAuthProvider,f["auth"].GoogleAuthProvider;function g(e){return{uid:e.uid,name:e.displayName,email:e.email,photo:e.photoURL,isNew:e.metadata.lastSignInTime===e.metadata.creationTime}}function v(){return f["auth"]().signOut()}function m(){let e=f["auth"]().currentUser;return e?g(e):null}function w(e){return f["auth"]().onAuthStateChanged(t=>{let i=null;t&&(i=g(t)),e(i)})}function b(e){return w(e)}var y={data:()=>({email:null,password:null,isSignedIn:!1,user:null,showUI:!1,OauthProviders:[{name:"Google",image:"google.png",iconColor:"#4285F4",backgroundColor:"#fafafa",textColor:"#555",provider:new f["auth"].GoogleAuthProvider},{name:"Facebook",icon:"fab fa-facebook",textColor:"#fff",backgroundColor:"#3b5998",provider:new f["auth"].FacebookAuthProvider}]}),created(){if("signout"===this.$route.params.action)console.log("signout"),v(),this.isSignedIn=!1,this.showUI=!0;else{let e=this.$route.query.redirect||"/";f["auth"]().getRedirectResult().then(t=>{this.user=t.user,this.user?(this.isSignedIn=!0,this.$router.push({path:e})):(this.isSignedIn=!1,this.showUI=!0)}).catch(e=>{console.log(e)})}},methods:{signIn(e){void 0===e?this.email&&this.password?f["auth"]().signInWithEmailAndPassword(this.email,this.password).catch(e=>{console.log(e)}):document.querySelectorAll("input").forEach(e=>{e.style.border="1px solid red"}):f["auth"]().signInWithRedirect(e)}}},x=y,C=(i("372b"),i("6544")),I=i.n(C),k=i("7496"),_=i("8336"),L=i("b0af"),A=i("62ad"),V=i("a523"),T=i("a75b"),P=i("490a"),S=i("0fd9"),D=Object(l["a"])(x,h,p,!1,null,"b4d6d81a",null);D.exports;I()(D,{VApp:k["a"],VBtn:_["a"],VCard:L["a"],VCol:A["a"],VContainer:V["a"],VContent:T["a"],VProgressCircular:P["a"],VRow:S["a"]});var F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("NavigationDrawer",{attrs:{temporary:!0}}),i("v-content",[i("AppBar"),i("v-container",{attrs:{fluid:"","fill-height":""}},[i("v-layout",{attrs:{row:"","align-top":"","justify-center":"","pa-3":""}},[i("v-flex",{staticClass:"pa-1",attrs:{xs2:""}},[i("v-card",{staticClass:"pa-2",attrs:{flat:""}},[i("v-card-actions",[i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$emit("export")}}},[i("v-icon",{attrs:{color:"primary",title:"export"}},[e._v("mdi-export")])],1),i("v-btn",{attrs:{icon:""}},[i("v-icon",{attrs:{color:"primary",title:"settings"}},[e._v("mdi-settings")])],1),i("v-btn",{attrs:{icon:""}},[i("v-icon",{attrs:{color:"green"}},[e._v("mdi-share-variant")])],1),i("v-btn",{attrs:{icon:""}},[i("v-icon",{attrs:{color:"green"}},[e._v("mdi-star-outline")])],1)],1),i("v-card-title",[e._v("\n              "+e._s(e.collection.name)+"\n            ")]),i("v-card-text",{staticClass:"text-left"},[e._v("\n              "+e._s(e.collection.description)+"\n            ")])],1),i("v-card",{attrs:{flat:""}},[i("v-card-title",e._l(e.keywords,function(t,r){return i("v-list",{key:r,staticClass:"pa-0"},[i("v-list-item",[i("v-checkbox",{attrs:{label:t.word,value:t.word},model:{value:e.selectedKeywords,callback:function(t){e.selectedKeywords=t},expression:"selectedKeywords"}})],1)],1)}),1)],1)],1),i("v-flex",{staticClass:"pa-1",attrs:{xs7:""}},[i("v-toolbar",{attrs:{flat:""}},[i("v-btn",{attrs:{small:"",color:"primary"},on:{click:e.selectPdfFiles}},[i("v-icon",{attrs:{title:"add papers"}},[e._v("mdi-plus")]),e._v("Add Paper\n            ")],1),i("v-spacer"),i("v-text-field",{attrs:{"single-line":"","hide-details":"",label:"Search","append-icon":"mdi-search"}})],1),i("PdfImporter",{ref:"PdfImporter"}),i("PaperList",{ref:"PaperList",on:{viewPaper:e.viewPaper}})],1),i("v-flex",{staticClass:"pa-1",attrs:{xs3:""}},[i("v-tabs",{attrs:{"background-color":"#eee"}},[i("v-tab",{staticClass:"pa-2",attrs:{to:"#references"},on:{click:function(t){e.activeTab="references"}}},[e._v("References")]),i("v-tab",{staticClass:"pa-2",attrs:{to:"#authors"},on:{click:function(t){e.activeTab="authors"}}},[e._v("Authors")])],1),e._l(e.references,function(t,r){return i("div",{key:r,staticClass:"ref-list"},[i("div",[e._v(e._s(t.origin)+" ")]),i("span",[e._v("("+e._s(t.nCitedBys)+") | Google Scholar")])])})],2)],1)],1)],1)],1)},E=[],N=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app-bar",{staticClass:"app-header",attrs:{app:"","clipped-left":"",flat:""}},[i("v-app-bar-nav-icon",{on:{click:e.toggleDrawer}}),i("v-toolbar-title",[e._v("PaperLax")]),i("v-layout",{staticStyle:{"margin-left":"2em"},attrs:{flat:""}},[i("v-btn",{attrs:{text:""}},[e._v("Home")]),i("v-btn",{attrs:{text:""}},[e._v("Explore")])],1),i("v-spacer"),i("UserMenu")],1)},O=[],B=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.currUser?i("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[i("v-btn",e._g({attrs:{large:"",icon:""}},r),[e.currUser.photo?e._e():i("v-icon",{key:"icon",attrs:{large:"",color:"grey darken-2"}},[e._v("\n        mdi-account-circle\n      ")]),i("v-avatar",{attrs:{size:"36px"}},[i("img",{attrs:{src:e.currUser.photo}})])],1)]}}])},[i("v-list",[i("v-subheader",[e._v(e._s(e.currUser.email))]),i("v-list-item",{attrs:{to:"/user#collections"}},[i("v-list-item-title",[e._v("My collections")])],1),i("v-list-item",{attrs:{to:"/user/settings"}},[i("v-list-item-title",[e._v("Settings")])],1),i("v-list-item",{attrs:{to:"/help"}},[i("v-list-item-title",[e._v("Help")])],1),i("v-list-item",{attrs:{to:"/auth/signout"}},[i("v-list-item-title",[e._v("Sign out")])],1)],1)],1):i("v-btn",{attrs:{text:"",small:"",to:"/auth/signin"}},[e._v("Sign In")])},R=[],j={name:"UserMenu",data(){return{currUser:m()}}},M=j,U=i("8212"),K=i("132d"),$=i("8860"),H=i("da13"),Q=i("5d23"),z=i("e449"),J=i("e0c7"),q=Object(l["a"])(M,B,R,!1,null,"0b5c3e06",null),X=q.exports;I()(q,{VAvatar:U["a"],VBtn:_["a"],VIcon:K["a"],VList:$["a"],VListItem:H["a"],VListItemTitle:Q["d"],VMenu:z["a"],VSubheader:J["a"]});var W={name:"AppBar",components:{UserMenu:X},data(){return{user:null}},methods:{toggleDrawer(){this.$store.commit("toggleNavigationDrawer")}}},G=W,Z=(i("352d"),i("40dc9")),Y=i("5bc1"),ee=i("a722"),te=i("2fa4"),ie=i("2a7f"),re=Object(l["a"])(G,N,O,!1,null,"11b2bdc6",null),ne=re.exports;I()(re,{VAppBar:Z["a"],VAppBarNavIcon:Y["a"],VBtn:_["a"],VLayout:ee["a"],VSpacer:te["a"],VToolbarTitle:ie["a"]});var se=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-navigation-drawer",{attrs:{app:"",temporary:e.isTemporary,fixed:"",clipped:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[i("CollectionFilter")],1)},ae=[],oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-list",[i("v-list-item-group",{attrs:{color:"primary"},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.filters,function(t,r){return i("v-list-item",{key:r,on:{click:function(t){return e.filterCollection(r)}}},[i("v-list-item-action",[i("v-icon",[e._v("\n          "+e._s(t.icon)+"\n        ")])],1),i("v-list-item-content",[i("v-list-item-title",{domProps:{textContent:e._s(t.text)}})],1)],1)}),1)],1)},le=[],ce={name:"CollectionFilter",data(){return{dialog:!1,selected:0,filters:[{text:"All Collections",icon:"mdi-home"},{text:"My Collections",icon:"mdi-face"},{text:"Shared with Me",icon:"mdi-account-multiple"},{text:"Watched",icon:"mdi-bookmark"}]}},methods:{filterCollection(e){this.selected=e,this.$log.info(this.selected)}}},de=ce,ue=(i("db71"),i("1800")),he=i("1baa"),pe=Object(l["a"])(de,oe,le,!1,null,"7a5ce521",null),fe=pe.exports;I()(pe,{VIcon:K["a"],VList:$["a"],VListItem:H["a"],VListItemAction:ue["a"],VListItemContent:Q["b"],VListItemGroup:he["a"],VListItemTitle:Q["d"]});var ge={name:"NavigationDrawer",components:{CollectionFilter:fe},props:{temporary:Boolean,drawerOpen:Boolean},data(){return{drawer:this.drawerOpen}},computed:{isTemporary:function(){return this.temporary}},mounted(){this.$store.subscribe((e,t)=>{switch(e.type){case"toggleNavigationDrawer":this.drawer=t.navigationDrawer;break}})}},ve=ge,me=i("f774"),we=Object(l["a"])(ve,se,ae,!1,null,null,null),be=we.exports;I()(we,{VNavigationDrawer:me["a"]});var ye=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{attrs:{flat:""}},[i("v-list",{attrs:{"two-line":""}},[e._l(e.papers,function(t,r){return[i("v-list-item",{key:t.title,staticStyle:{cursor:"pointer"},attrs:{ripple:""}},[i("div",{staticClass:"left-icons"},[i("v-icon",{attrs:{flat:"",small:"",color:"primary",title:"read PDF"}},[e._v("mdi-file")])],1),i("v-list-item-content",{on:{click:function(i){return e.viewPaper(t.id)}}},[i("v-list-item-title",[i("span",{staticClass:"dot",style:"background-color: "+t.color}),e._v("\n            "+e._s(t.title)+"\n          ")]),i("v-list-item-subtitle",{staticClass:"text--primary"},[e._v("\n            "+e._s(t.year)+",\n            "+e._s(e.showAuthorNames(t.authors))+"\n          ")])],1),t.uploadProgress?i("v-list-item-action",[i("v-progress-circular",{attrs:{rotate:-90,size:50,width:8,value:t.uploadProgress,color:"blue"}},[e._v("\n            "+e._s(t.uploadProgress)+"\n          ")])],1):e._e(),i("div",{staticClass:"right-icons"},[e._l(e.actions,function(t,n){return[t.shown?i("v-icon",{key:n,attrs:{title:t.action},on:{click:function(t){return e.paperAction(r)}}},[e._v(e._s(t.icon))]):e._e()]})],2)],1),r+1<e.papers.length?i("v-divider",{key:r}):e._e()]})],2)],1)},xe=[],Ce={name:"PaperList",data(){return{papers:[],paperLoadingStatus:{},actions:[{icon:"mdi-check",action:"check",color:"green",shown:!1},{icon:"mdi-pencil",action:"edit",color:"orange",shown:!0},{icon:"mdi-delete",action:"delete",color:"red",shown:!0}],value:10}},methods:{addPaper(e){e.uploadProgress=0,this.papers.push(e),e.uploadTask.on("state_changed",t=>{let i=t.bytesTransferred/t.totalBytes*100;e.uploadProgress=i.toPrecision(2)})},clear(){this.papers=[]},viewPaper(e){this.$emit("viewPaper",e)},updatePaper(e){let t=this.papers.find(t=>t.id===e.id);Object.keys(e).forEach(i=>{t.hasOwnProperty(i)&&"id"!==i&&(t[i]=e[i])})},editPaperInfo(e){console.log(this.papers[e].id);let t=this.papers[e];this.$emit("editPaperInfo",t),this.$emit("viewPaper",e)},showAuthorNames(e){if(Array.isArray(e))return e.map(e=>e.given+" "+e.family).join(", ")},paperAction(e,t){"edit"===e?this.editPaperInfo(t):"delete"===e&&(this.papers.splice(t,1),this.$emit("updatePapersInCollection",this.papers.map(e=>e.id)))}}},Ie=Ce,ke=(i("bb91"),i("ce7e")),_e=Object(l["a"])(Ie,ye,xe,!1,null,"82d3d59c",null),Le=_e.exports;I()(_e,{VCard:L["a"],VDivider:ke["a"],VIcon:K["a"],VList:$["a"],VListItem:H["a"],VListItemAction:ue["a"],VListItemContent:Q["b"],VListItemSubtitle:Q["c"],VListItemTitle:Q["d"],VProgressCircular:P["a"]});var Ae=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-flex",[i("v-card",{attrs:{flat:""}},[i("v-card-title",[e._v("\n      All References\n      "),i("v-btn",{attrs:{color:"primary",small:"",outline:""},on:{click:function(t){return e.exportAsJson()}}},[e._v("\n        Export\n      ")]),i("v-spacer"),i("v-text-field",{attrs:{"append-icon":"search",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),i("v-data-table",{attrs:{headers:e.headers,items:e.references,search:e.search,"rows-per-page-items":[10,15,25,50]},scopedSlots:e._u([{key:"items",fn:function(t){return[i("td",{staticClass:"subheading",staticStyle:{"text-align":"left"},on:{mouseenter:function(i){e.hoverId=t.item.id}}},[e._v(e._s(t.item.title)+" "),t.item.venue?i("span",{staticClass:"caption"},[e._v("("+e._s(t.item.venue)+")")]):e._e(),t.item.id==e.hoverId?i("v-icon",{on:{click:function(i){return e.editReference(t.item.id)}}},[e._v("edit")]):e._e()],1),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.year)),i("br")]),i("td",{staticClass:"text-xs-right"},[e._v(e._s(e.showAuthorNames(t.item.authorNames))),i("br")]),i("td",{staticClass:"text-xs-right"},[e._v(e._s(t.item.citedByCount))])]}}])},[i("v-alert",{attrs:{slot:"no-results",value:!0,color:"error",icon:"warning"},slot:"no-results"},[e._v('\n        Your search for "'+e._s(e.search)+'" found no results.\n      ')])],1)],1),i("v-dialog",{attrs:{"max-width":"50%"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[e._v("Reference Info & Edit")]),i("v-card-text",[e._v("\n        "+e._s(e.selectedReference.origin)+"\n      ")]),i("v-card-text",[i("v-textarea",{attrs:{rows:"10",outline:""},model:{value:e.editedRefInfo,callback:function(t){e.editedRefInfo=t},expression:"editedRefInfo"}})],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"green darken-1",flat:"flat"},on:{click:function(t){return e.saveRefInfo()}}},[e._v("\n          Save\n        ")]),i("v-btn",{attrs:{flat:"flat"},on:{click:function(t){e.dialog=!1}}},[e._v("\n          Cancel\n        ")])],1)],1)],1)],1)},Ve=[],Te={name:"Paper",data(){return{search:"",dialog:!1,hoverId:null,selectedReference:{},references:[],editedRefInfo:"",headers:[{text:"Title",value:"title",sortable:!1},{text:"Year",value:"year"},{text:"Authors",value:"authorNames"},{text:"Cited By",value:"citedByCount"}]}},methods:{update(e){this.references=e},append(e){let t=this.references.map(e=>e.id);if(-1===t.indexOf(e.id))this.references.push(e);else{let t=this.references.find(t=>t.id===e.id);t.citedByCount+=1}},showTitle(e){return e.length>64?e.slice(0,63)+" ...":e},showAuthorNames(e){if(Array.isArray(e))return e.join(", ")},editReference(e){console.log(e),this.selectedReference=this.references.find(t=>t.id===e),this.dialog=~this.dialog,this.editedRefInfo=this.showRefInfo()},showRefInfo(e,t=!1){let i=e||this.selectedReference;if(!i.title)return;let r={title:i.title,authorNames:i.authorNames.join(", "),venue:i.venue,year:i.year,publisher:i.publisher,pages:i.pages,volume:i.volume,issue:i.issue};return t&&(r.origin=i.origin),JSON.stringify(r,null,4)},saveRefInfo(){let e=JSON.parse(this.editedRefInfo);e.authorNames=e.authorNames.split(",").map(e=>e.trim()),this.selectedReference=Object.assign(this.selectedReference,e),this.dialog=!1,this.$emit("saveRefInfo",this.selectedReference)},exportAsJson(){let e=this.references.map(e=>this.showRefInfo(e,!0));e="["+e.join(", ")+"]";let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","references.json"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}},Pe=Te,Se=i("0798"),De=i("99d9"),Fe=i("8fea"),Ee=i("169a"),Ne=i("0e8f"),Oe=i("8654"),Be=i("a844"),Re=Object(l["a"])(Pe,Ae,Ve,!1,null,null,null),je=Re.exports;I()(Re,{VAlert:Se["a"],VBtn:_["a"],VCard:L["a"],VCardActions:De["a"],VCardText:De["b"],VCardTitle:De["c"],VDataTable:Fe["a"],VDialog:Ee["a"],VFlex:Ne["a"],VIcon:K["a"],VSpacer:te["a"],VTextField:Oe["a"],VTextarea:Be["a"]});const Me={register(){let e=m();return f["firestore"]().collection("users").doc(e.uid).set(e)},getCollections(){return new Promise((e,t)=>{Ue.list().then(t=>{e(t.docs.map(e=>({id:e.id,...e.data()})))}).catch(e=>{t(e)})})}},Ue={add(e){const t=m();return f["firestore"]().collection("collections").add({...e,owner:t.uid})},get(e){return f["firestore"]().doc(`collections/${e}`).get().then(t=>{if(t.exists)return t.data();throw new Error(`"${e}" not found in collections.`)})},list(){const e=m();return f["firestore"]().collection("collections").where("owner","==",e.uid).get()},Articles:{add(e,t){Array.isArray(t)||"object"!==typeof t||(t=[t]);let i=f["firestore"]().collection("collections").doc(e);t.forEach(e=>{if(!e.id)return;let t=i.collection("articles").doc(e.id);t.get().then(i=>{if(i.exists){let r={};for(const[t,n]of Object.entries(i.data()))e[t]!==n&&(r[t]=n);t.update(r)}else t.set(e)})})},list(e){return new Promise((t,i)=>{f["firestore"]().collection("collections").doc(e).collection("articles").get().then(e=>{let i=[];e.forEach(e=>{i.push(e.data())}),t(i)}).catch(e=>{i(e)})})}}};var Ke=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("input",{ref:"InputFiles",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:e.loadFiles}})},$e=[],He=i("9511"),Qe=i.n(He),ze=i("bc3a"),Je=i.n(ze);class qe{constructor(e){this.parse="rnn"===e?this.classifyByRnn:"anystyle"===e?this.useAnystyle:this.simplyParse}parseRefStrings(e){let t=[],i=[new RegExp(/^\[(.+)\]/),new RegExp(/^(\d{1,2})\./)],r=null,n="";return e.forEach(e=>{if(null===r)for(let t=0;t<i.length;t++){let n=i[t];if(e.match(n)){r=n;break}}else{let i=e.match(r);if(i)i[1].match(/^\d+$/)&&"Online"!==i[1]?Number(i[1])===t.length+2&&(t.push(n),n=e.replace(r,"")):(t.push(n.trim()),n="");else{let t=n.slice(-1);" "===t||"-"===t?("-"===t&&(n=n.slice(0,-1)),n+=e):n+=" "+e}}}),t[t.length-1].length>500&&(t[t.length-1]=t[t.length-1].slice(0,500)),t}useAnystyle(e){let t=this.parseRefStrings(e),i=t.map(e=>"'"+e+"'").join("+");return new Promise((e,r)=>{Je()("/api/anystyle?refs="+encodeURIComponent(i)).then(i=>{console.log(JSON.parse(i.data)),e({raw:t,parsed:JSON.parse(i.data)})}).catch(e=>{r(e)})})}classifyByRnn(){}}class Xe{constructor(e){this.pdf=null,this.pdfUrl=e,this.refParser=new qe,this.pages=[]}async load(){return null===this.pdf?await Qe.a.getDocument({url:this.pdfUrl}).promise:await this.pdf}getInfo(){return this.load().then(e=>{return e.getMetadata()}).then(e=>{let t=e.info,i=t.CreationDate?t.CreationDate.slice(2,6):"unknown",r=!!t.Author&&t.Author.replace("and",",").split(","),n=!!(t.Title&&t.Title.length>10)&&t.Title;return r&&n?this.parseInfo({year:i,authors:r,title:n}):this.parseInfo({year:i})})}getPage(e){return new Promise((t,i)=>{this.pages[e]?t(this.pages[e]):this.load().then(i=>{i.getPage(e).then(i=>{this.pages[e]=i,t(i)})}).catch(e=>{i(e)})})}parseInfo(e){return this.load().then(e=>{return e.getPage(1)}).then(e=>{return e.getTextContent()}).then(t=>{let i=t.items,r={},n=[],s=[],a=!1,o=!1;for(let e=0;e<i.length;e++){let t=i[e];if(t.str.match(/ntroduction$/i))break;o&&t.str.length>3&&s.push(t.str),(t.str.match(/eywords:?$/i)||t.str.match(/^Index Terms$/i))&&(a=!1,o=!0),a&&n.push(t.str),t.str.match(/bstract$/i)&&(a=!0)}if(n=n.join(" ").replace(/\s+/g," "),s=s.join(""),e.title&&e.authors)r=Object.assign({},e);else{const e=10,t=5,n=30;let s=i.slice(0,n).filter(t=>t.str.length>e),a=Math.max(...s.map(e=>e.height)),o=i.slice(0,n).map(e=>e.height).indexOf(a),l=i[o].str,c=o+1,d=i[c].str;d.includes(",")||d.includes("and")||(l+=d,c++,d=i[c].str);while(d.length<t)c++,d=i[c].str;d=d.replace("and",",").split(","),r={title:l,authors:d}}return r.abstract=n,r.keywords=s,r.year=e.year,new Promise((e,t)=>{e(r)})})}getReferenceTexts(e){let t=e;for(const[i,r]of e.entries())if("eferences"===r.str.toLowerCase()||"references"===r.str.toLowerCase()||r.str.match(/^\d+.*references$/i)){t=e.slice(i+1);break}return t}sanitizeUrl(e){return e.replace(/\[.+\]/,"").replace(/'/g,"").replace(/\(/g,"").replace(/\)/g,"").replace("- ","").replace("&","")}sanitize(e){return e.map(e=>e.str.replace(/\[(O|o)nline.*\]/g,"online"))}getReferences(){let e;return this.load().then(t=>{let i=!1;return t.getPage(t.numPages).then(e=>{return e.getTextContent()}).then(r=>{return e=this.getReferenceTexts(r.items),i=e.length!==r.items.length,i?new Promise((t,i)=>{t(e)}):t.getPage(t.numPages-1)}).then(e=>{if(!i)return e.getTextContent()}).then(t=>{let r=[];return i||(r=this.getReferenceTexts(t.items),e=r.concat(e)),i||r.length!==t.items.length?this.refParser.useAnystyle(e.map(e=>e.str)):new Promise((e,t)=>{e()})}).then(e=>{return new Promise((t,i)=>{t(e)})})})}}function We(e,t){return`PDFs/${e}/${t}.pdf`}function Ge(e,t,i){return f["storage"]().ref().child(We(e,t)).put(i)}function Ze(e,t){return f["storage"]().ref().child(We(e,t)).getDownloadURL()}var Ye=i("0fe3"),et=i.n(Ye),tt=function(e,t,i){if(!e||!t||!i)return null;let r=i.replace(/\s+/g," ").trim().toLowerCase();const n=12,s=16,a=et.a.h64(r,n).toString(s);return`${e.toLowerCase()}-${t}-${a}`},it={name:"PdfImporter",data(){return{collectionId:null,onFileLoaded:null,onUploadStateChanged:null,storageRef:null}},created(){this.collectionId=this.$route.params.collectionId},methods:{selectFiles(){const e=this.$refs.InputFiles;e.click()},loadFiles(e){let t=e.target.files;if(0!==t.length)for(let i of t){let e,t,r=URL.createObjectURL(i),n=new Xe(r);n.getInfo().then(r=>{e=Object.assign({},r),e.authors=r.authors.map(e=>e.trim()).filter(e=>""!==e).map(e=>{let t=e.split(" ");return{family:t.pop(),given:t}}),e.id=tt(e.authors[0].family,e.year,e.title),n.getReferences().then(r=>{if(r.parsed.length>0){let n=r.parsed;if(t=n.map((e,t)=>{let i={};if(Array.isArray(e.title))return i.title=e.title[0],i.authors=Array.isArray(e.author)?e.author:[""],Array.isArray(e["container-title"])&&e["container-title"].length&&(i.venue=e["container-title"]?e["container-title"][0].replace(/-/g,""):""),i.year=Array.isArray(e.date)?e.date[0]:"unknown",Array.isArray(e.date)&&(i.date=e.date[0]),e.pages&&(i.pages=Array.isArray(e.pages)?e.pages[0]:e.pages),e.publisher&&(i.publisher=Array.isArray(e.publisher)?e.publisher[0]:e.publisher),e.volume&&(i.volume=Array.isArray(e.volume)?e.volume[0]:e.volume),e.issue&&(i.issue=Array.isArray(e.issue)?e.issue[0]:e.issue),i.origin=r.raw[t],i.id=tt(i.authors[0].family,i.year,i.title),i}).filter(e=>void 0!==e&&null!==e.id),Ue.Articles.add(this.collectionId,t),e.references=t.map(e=>e.id),null!==e.id){Ue.Articles.add(this.collectionId,Object.assign({},e));let t=Ge(this.collectionId,e.id,i);t.then(()=>{console.log("uploaded file"+e.id)}),e.uploadTask=t,"function"===typeof this.onFileLoaded&&this.onFileLoaded(e)}}})})}}}},rt=it,nt=Object(l["a"])(rt,Ke,$e,!1,null,null,null),st=nt.exports,at={name:"CollectionView",components:{AppBar:ne,NavigationDrawer:be,PaperList:Le,RefList:je,PdfImporter:st},data:()=>({activeTab:"references",localStore:null,collectionId:null,collection:{name:null,description:null},articles:null,references:[],keywords:[],selectedKeywords:[]}),created(){this.collectionId=this.$route.params.collectionId,Ue.get(this.collectionId).then(e=>{this.collection=e})},mounted(){this.$refs.PdfImporter.onFileLoaded=(e,t)=>{this.$refs.PaperList.addPaper(e)},Ue.Articles.list(this.collectionId).then(e=>{this.articles=e.filter(e=>!e.hasOwnProperty("origin"));let t={};this.articles.forEach(e=>{e.keywords.replace(/[^a-zA-Z0-9\s,]/g,"").toLowerCase().split(", ").filter(e=>e.length>2&&e.length<32).forEach(e=>{t.hasOwnProperty(e)?t[e]+=1:t[e]=1})}),this.keywords=Object.keys(t).map(e=>{return{word:e,count:t[e]}}),this.$refs.PaperList.papers=this.articles;let i={};this.articles.forEach(e=>{e.references.forEach(e=>{i.hasOwnProperty(e)?i[e]+=1:i[e]=1})}),this.references=e.filter(e=>e.hasOwnProperty("origin")).map(e=>{return e.nCitedBys=i[e.id],e}).sort((e,t)=>t.nCitedBys-e.nCitedBys).slice(0,7)})},methods:{selectPdfFiles(){this.$refs.PdfImporter.selectFiles()},viewPaper(e){this.$router.push({path:"/reader/"+this.collectionId+"/"+e})}}},ot=at,lt=(i("3c0f"),i("ac7c")),ct=i("71a3"),dt=i("fe57"),ut=i("71d9"),ht=Object(l["a"])(ot,F,E,!1,null,"45bebed2",null);ht.exports;I()(ht,{VApp:k["a"],VBtn:_["a"],VCard:L["a"],VCardActions:De["a"],VCardText:De["b"],VCardTitle:De["c"],VCheckbox:lt["a"],VContainer:V["a"],VContent:T["a"],VFlex:Ne["a"],VIcon:K["a"],VLayout:ee["a"],VList:$["a"],VListItem:H["a"],VSpacer:te["a"],VTab:ct["a"],VTabs:dt["a"],VTextField:Oe["a"],VToolbar:ut["a"]});var pt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("NavigationDrawer",{attrs:{drawerOpen:!0,temporary:!1}}),i("v-content",[i("AppBar"),i("v-container",{attrs:{fluid:"","fill-height":""}},[i("v-layout",{attrs:{row:"","align-top":"","justify-center":""}},[i("CollectionList",{ref:"UserCollections"})],1)],1)],1)],1)},ft=[],gt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-container",[i("v-toolbar",{attrs:{flat:"",dense:"",color:"#f5f5f5"}},[i("v-toolbar-title",[e._v("Paper Collections")]),i("v-spacer"),i("v-btn",{staticClass:"ma-3",attrs:{small:"",color:"primary"},on:{click:function(t){e.dialog=!0}}},[i("v-icon",{attrs:{left:""}},[e._v("mdi-plus")]),e._v("New Collection\n    ")],1)],1),i("v-list",{attrs:{"two-line":""}},[e._l(e.collections,function(t,r){return[i("v-list-item",{key:t.title,staticStyle:{cursor:"pointer"},attrs:{ripple:"",to:e.collectionURL(t)}},[i("v-list-item-content",[i("v-list-item-title",{staticClass:"text--primary"},[e._v("\n            "+e._s(t.name)+"\n          ")]),i("v-list-item-subtitle",[e._v("\n            "+e._s(t.description)+"\n          ")])],1),i("v-list-item-action",[i("v-list-item-action-text",[e._v(e._s(t.nArticle))])],1)],1),r+1<e.collections.length?i("v-divider",{key:r}):e._e()]})],2),i("v-dialog",{attrs:{persistent:"","max-width":"60%"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[i("v-card",[i("v-card-title",{staticClass:"headline"},[e._v("Create new collection")]),i("v-card-text",[i("v-text-field",{attrs:{label:"Name"},model:{value:e.newCollection.title,callback:function(t){e.$set(e.newCollection,"title",t)},expression:"newCollection.title"}}),i("v-text-field",{attrs:{label:"Discription",box:""},model:{value:e.newCollection.description,callback:function(t){e.$set(e.newCollection,"description",t)},expression:"newCollection.description"}})],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{color:"green darken-1",flat:"flat"},on:{click:function(t){return e.createCollection()}}},[e._v("\n          Create\n        ")]),i("v-btn",{attrs:{flat:"flat"},on:{click:function(t){e.dialog=!1}}},[e._v("\n          Cancel\n        ")])],1)],1)],1)],1)},vt=[],mt=(i("e71f"),{name:"CollectionList",data(){return{dialog:!1,collections:[],newCollection:null,actions:["edit","delete"]}},created(){this.setDefaultsForNewCollection()},methods:{collectionURL(e){return"/collection/"+e.id},createCollection(){this.newCollection.lastUpdated=f["firestore"].FieldValue.serverTimestamp(),Ue.add(this.newCollection).then(()=>{this.collections.push(Object.assign({},this.newCollection)),this.setDefaultsForNewCollection(),this.dialog=!1})},setDefaultsForNewCollection(){this.newCollection={name:null,description:null,nArticle:0,public:!1}},commitAction(e,t){"edit"===e?this.$log.info(e,t):"delete"===e&&this.$log.info(e,t)}}}),wt=mt,bt=(i("c8d2"),Object(l["a"])(wt,gt,vt,!1,null,"17044931",null)),yt=bt.exports;I()(bt,{VBtn:_["a"],VCard:L["a"],VCardActions:De["a"],VCardText:De["b"],VCardTitle:De["c"],VContainer:V["a"],VDialog:Ee["a"],VDivider:ke["a"],VIcon:K["a"],VList:$["a"],VListItem:H["a"],VListItemAction:ue["a"],VListItemActionText:Q["a"],VListItemContent:Q["b"],VListItemSubtitle:Q["c"],VListItemTitle:Q["d"],VSpacer:te["a"],VTextField:Oe["a"],VToolbar:ut["a"],VToolbarTitle:ie["a"]});var xt={name:"UserPage",components:{AppBar:ne,CollectionList:yt,NavigationDrawer:be},data:()=>({user:null,activeTab:"paper",localStore:null,collection:{name:"Progressive visual analysis",description:null}}),created(){this.user=m(),this.user.isNew&&Me.register(this.user)},mounted(){Me.getCollections().then(e=>{console.log(e),this.$refs.UserCollections.collections=e})},methods:{toggleDrawer(){this.drawer=!this.drawer}}},Ct=xt,It=(i("2e57"),Object(l["a"])(Ct,pt,ft,!1,null,"7f1e49e1",null));It.exports;I()(It,{VApp:k["a"],VContainer:V["a"],VContent:T["a"],VLayout:ee["a"]});var kt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("v-content",[i("v-app-bar",{attrs:{dense:"",flat:"",app:"","clipped-left":"","clipped-right":"",color:"#EEE"}},[i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$router.go(-1)}}},[i("v-icon",[e._v("mdi-arrow-left")])],1),i("v-flex",{attrs:{"justify-center":""}},[i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomOut()}}},[i("v-icon",[e._v("mdi-magnify-minus-outline")])],1),i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomIn()}}},[i("v-icon",[e._v("mdi-magnify-plus-outline")])],1),i("v-btn",{attrs:{icon:"",disabled:e.pageNumber<2},on:{click:function(t){e.pageNumber-=1}}},[i("v-icon",[e._v("mdi-chevron-left")])],1),i("input",{directives:[{name:"model",rawName:"v-model",value:e.pageNumber,expression:"pageNumber"}],staticClass:"page-number-input",attrs:{type:"text",value:"1",size:"2"},domProps:{value:e.pageNumber},on:{input:function(t){t.target.composing||(e.pageNumber=t.target.value)}}}),e._v(" / "+e._s(e.pageTotal)+"\n        "),i("v-btn",{attrs:{icon:"",disabled:e.pageNumber>=e.pageTotal},on:{click:function(t){e.pageNumber+=1}}},[i("v-icon",[e._v("mdi-chevron-right")])],1)],1),e.allowPdfFile?i("v-btn",{attrs:{icon:""},on:{click:e.selectLocalFile}},[i("v-icon",[e._v("mdi-file-upload")])],1):e._e(),i("UserMenu")],1),i("v-container",{attrs:{fluid:""}},[i("input",{ref:"LocalPdfFile",staticClass:"hidden",attrs:{type:"file"},on:{change:e.loadFile}}),i("div",{ref:"viewerContainer",attrs:{id:"viewerContainer"}},[i("div",{ref:"pdfViewer",staticClass:"pdfViewer",attrs:{id:"viewer"}})]),i("div",{attrs:{id:"loadingBar"}},[i("div",{staticClass:"progress"}),i("div",{staticClass:"glimmer"})]),i("div",{attrs:{id:"errorWrapper",hidden:"true"}},[i("div",{attrs:{id:"errorMessageLeft"}},[i("span",{attrs:{id:"errorMessage"}}),i("button",{attrs:{id:"errorShowMore"}},[e._v("\n            More Information\n          ")]),i("button",{attrs:{id:"errorShowLess"}},[e._v("\n            Less Information\n          ")])]),i("div",{attrs:{id:"errorMessageRight"}},[i("button",{attrs:{id:"errorClose"}},[e._v("\n            Close\n          ")])]),i("div",{staticClass:"clearBoth"}),i("textarea",{attrs:{id:"errorMoreInfo",hidden:"true",readonly:"readonly"}})])])],1),i("v-navigation-drawer",{staticClass:"pa-2",attrs:{clipped:"",app:"",width:"18%"}},[i("PaperOutline",{attrs:{outline:e.outline}})],1),i("v-navigation-drawer",{attrs:{clipped:"",app:"",right:"",width:"18%"},model:{value:e.navRight,callback:function(t){e.navRight=t},expression:"navRight"}},[i("v-tabs",[i("v-tab",[e._v("Snippets")]),i("v-tab",[e._v("Comments")])],1)],1)],1)},_t=[],Lt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{staticClass:"text-left",attrs:{flat:""}},[i("v-card-title",[e._v("Outline")]),i("v-treeview",{attrs:{dense:"","open-all":"",activatable:"",items:e.items},scopedSlots:e._u([{key:"label",fn:function(t){var r=t.item;return[i("a",{on:{click:function(t){return e.select(r.name)}}},[e._v(e._s(r.name))])]}}])})],1)},At=[],Vt={props:{outline:Array},computed:{items(){if(!this.outline)return[];let e=0;return this.outline.map((t,i)=>{return{id:e++,name:t.title,children:t.items?t.items.map(t=>{return{id:e++,name:t.title}}):[]}})}},methods:{select(e){console.log(e)}}},Tt=Vt,Pt=i("eb2a"),St=Object(l["a"])(Tt,Lt,At,!1,null,null,null),Dt=St.exports;I()(St,{VCard:L["a"],VCardTitle:De["c"],VTreeview:Pt["a"]});var Ft=i("968b"),Et=(i("9a26"),i("8b22")),Nt=i("8588"),Ot=i("72d0");const Bt=300;class Rt{constructor({textLayerDiv:e,eventBus:t,pageIndex:i,viewport:r,findController:n=null,enhanceTextSelection:s=!1,highlights:a=[],highlightTexts:o=[]}){this.textLayerDiv=e,this.eventBus=t||Object(Nt["getGlobalEventBus"])(),this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageIdx=i,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=r,this.textDivs=[],this.findController=n,this.textLayerRenderTask=null,this.enhanceTextSelection=s,this.highlights=a,this.highlightTexts=o,this._bindMouse()}_finishRendering(){if(this.renderingDone=!0,!this.enhanceTextSelection){let e=document.createElement("div");e.className="endOfContent",this.textLayerDiv.appendChild(e)}this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length})}render(e=0){if(!this.textContent&&!this.textContentStream||this.renderingDone)return;this.cancel(),this.textDivs=[];let t=document.createDocumentFragment();this.textLayerRenderTask=Object(Ot["renderTextLayer"])({textContent:this.textContent,textContentStream:this.textContentStream,container:t,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:e,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then(()=>{this.textLayerDiv.appendChild(t),this._finishRendering(),this.updateMatches(),this.updateHighlights()},function(e){})}cancel(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null)}setTextContentStream(e){this.cancel(),this.textContentStream=e}setTextContent(e){this.cancel(),this.textContent=e}convertMatches(e,t){let i=0,r=0,n=this.textContentItemsStr,s=n.length-1,a=null===this.findController||t?0:this.findController.state.query.length,o=[];if(!e)return o;for(let l=0,c=e.length;l<c;l++){let c=e[l];while(i!==s&&c>=r+n[i].length)r+=n[i].length,i++;i===n.length&&console.error("Could not find a matching mapping");let d={begin:{divIdx:i,offset:c-r}};c+=t?t[l]:a;while(i!==s&&c>r+n[i].length)r+=n[i].length,i++;d.end={divIdx:i,offset:c-r},o.push(d)}return o}renderMatches(e){if(0===e.length)return;let t=this.textContentItemsStr,i=this.textDivs,r=null,n=this.pageIdx,s=null!==this.findController&&n===this.findController.selected.pageIdx,a=null===this.findController?-1:this.findController.selected.matchIdx,o=null!==this.findController&&this.findController.state.highlightAll,l={divIdx:-1,offset:void 0};function c(e,t){let r=e.divIdx;i[r].textContent="",d(r,0,e.offset,t)}function d(e,r,n,s){let a=i[e],o=t[e].substring(r,n),l=document.createTextNode(o);if(s){let e=document.createElement("span");return e.className=s,e.appendChild(l),void a.appendChild(e)}a.appendChild(l)}let u=a,h=u+1;if(o)u=0,h=e.length;else if(!s)return;for(let p=u;p<h;p++){let t=e[p],o=t.begin,u=t.end,h=s&&p===a,f=h?" selected":"";if(this.findController&&this.findController.updateMatchPosition(n,p,i,o.divIdx),r&&o.divIdx===r.divIdx?d(r.divIdx,r.offset,o.offset):(null!==r&&d(r.divIdx,r.offset,l.offset),c(o)),o.divIdx===u.divIdx)d(o.divIdx,o.offset,u.offset,"highlight"+f);else{d(o.divIdx,o.offset,l.offset,"highlight begin"+f);for(let e=o.divIdx+1,t=u.divIdx;e<t;e++)i[e].className="highlight middle"+f;c(u,"highlight end"+f)}r=u}r&&d(r.divIdx,r.offset,l.offset)}updateMatches(){if(!this.renderingDone)return;let e,t,i=this.matches,r=this.textDivs,n=this.textContentItemsStr,s=-1;for(let a=0,o=i.length;a<o;a++){let e=i[a],t=Math.max(s,e.begin.divIdx);for(let i=t,s=e.end.divIdx;i<=s;i++){let e=r[i];e.textContent=n[i],e.className=""}s=e.end.divIdx+1}null!==this.findController&&this.findController.active&&(null!==this.findController&&(e=this.findController.pageMatches[this.pageIdx]||null,t=this.findController.pageMatchesLength&&this.findController.pageMatchesLength[this.pageIdx]||null),this.matches=this.convertMatches(e,t),this.renderMatches(this.matches))}renderHighlights(e){if(0===e.length)return;let t=this.textContentItemsStr,i=this.textDivs,r=null,n={divIdx:-1,offset:void 0};function s(e,t,r){let n=e.divIdx;i[n].textContent="",a(n,0,e.offset,t,r)}function a(e,r,n,s,a){let o=i[e],l=t[e].substring(r,n),c=document.createTextNode(l);if(s){let e=document.createElement("span");return e.className=s,Object.assign(e.style,a),e.appendChild(c),void o.appendChild(e)}o.appendChild(c)}let o=0,l=e.length;for(let c=o;c<l;c++){let t=e[c],o=t.begin,l=t.end,d="";if(r&&o.divIdx===r.divIdx?a(r.divIdx,r.offset,o.offset,{backgroundColor:t.bgColor}):(null!==r&&a(r.divIdx,r.offset,n.offset,{backgroundColor:t.bgColor}),s(o)),o.divIdx===l.divIdx)a(o.divIdx,o.offset,l.offset,"highlight"+d,{backgroundColor:t.bgColor});else{a(o.divIdx,o.offset,n.offset,"highlight begin"+d,{backgroundColor:t.bgColor});for(let e=o.divIdx+1,r=l.divIdx;e<r;e++)i[e].className="highlight middle"+d,Object.assign(i[e].style,{backgroundColor:t.bgColor});s(l,"highlight end"+d,{backgroundColor:t.bgColor})}r=l}r&&a(r.divIdx,r.offset,n.offset)}updateHighlights(){if(!this.renderingDone)return;let e=this.highlights,t=this.textDivs,i=this.textContentItemsStr,r=-1;for(let c=0,d=e.length;c<d;c++){let n=e[c],s=Math.max(r,n.begin.divIdx);for(let e=s,r=n.end.divIdx;e<=r;e++){let r=t[e];r.textContent=i[e],r.className="",r.style.backgroundColor=null}r=n.end.divIdx+1}const n=this.findController._pageContents[this.pageIdx],s=[],a=[],o=[];this.highlightTexts.forEach(({text:e,bgColor:t})=>{const i=n.indexOf(e);-1!==i&&(s.push(n.indexOf(e)),a.push(e.length),o.push(t))});const l=this.convertMatches(s,a);this.highlights=l.map((e,t)=>({...e,bgColor:o[t]})),this.renderHighlights(this.highlights)}_bindMouse(){let e=this.textLayerDiv,t=null;e.addEventListener("mousedown",i=>{if(this.enhanceTextSelection&&this.textLayerRenderTask)return this.textLayerRenderTask.expandTextDivs(!0),void("undefined"!==typeof PDFJSDev&&PDFJSDev.test("FIREFOX || MOZCENTRAL")||!t||(clearTimeout(t),t=null));let r=e.querySelector(".endOfContent");if(r){if("undefined"===typeof PDFJSDev||!PDFJSDev.test("FIREFOX || MOZCENTRAL")){let t=i.target!==e;if(("undefined"===typeof PDFJSDev||PDFJSDev.test("GENERIC"))&&(t=t&&"none"!==window.getComputedStyle(r).getPropertyValue("-moz-user-select")),t){let t=e.getBoundingClientRect(),n=Math.max(0,(i.pageY-t.top)/t.height);r.style.top=(100*n).toFixed(2)+"%"}}r.classList.add("active")}}),e.addEventListener("mouseup",()=>{if(this.enhanceTextSelection&&this.textLayerRenderTask)return void("undefined"!==typeof PDFJSDev&&PDFJSDev.test("FIREFOX || MOZCENTRAL")?this.textLayerRenderTask.expandTextDivs(!1):t=setTimeout(()=>{this.textLayerRenderTask&&this.textLayerRenderTask.expandTextDivs(!1),t=null},Bt));let i=e.querySelector(".endOfContent");i&&("undefined"!==typeof PDFJSDev&&PDFJSDev.test("FIREFOX || MOZCENTRAL")||(i.style.top=""),i.classList.remove("active"))})}}Qe.a.GlobalWorkerOptions.workerSrc="../../node_modules/pdfjs-dist/build/pdf.worker.js";let jt=8388608,Mt="../../node_modules/pdfjs-dist/cmaps/",Ut=!0,Kt=1.1,$t=.25,Ht=10;var Qt={name:"PaperReader",components:{UserMenu:X,PaperOutline:Dt},data:()=>({user:null,collectionId:null,paperId:null,loading:!0,allowPdfFile:!1,navRight:!0,pdfLoadingTask:null,pdfDocument:null,pdfViewer:null,pdfHistory:null,pdfLinkService:null,pageNumber:1,outline:null,highlightLayers:[]}),computed:{pageTotal(){return this.pdfDocument?this.pdfDocument.numPages:1},loadingBar(){let e=new Ft["ProgressBar"]("#loadingBar",{});return Qe.a.shadow(this,"loadingBar",e)}},watch:{pageNumber(){"string"===typeof this.pageNumber&&(this.pageNumber=parseInt(this.pageNumber)),document.getElementsByClassName("page")[this.pageNumber-1].scrollIntoView()}},created(){this.collectionId=this.$route.params.collectionId,this.paperId=this.$route.params.paperId},async mounted(){if(this.initPdfViewer(),this.collectionId&&this.paperId){let t=await Ze(this.collectionId,this.paperId);try{this.open({url:t})}catch(e){console.log(e)}}else this.allowPdfFile=!0},methods:{initPdfViewer(){this.l10n=Ft["NullL10n"];let e=this.$refs.viewerContainer;this.pdfLinkService=new Ft["PDFLinkService"],this.findController=new Et["PDFFindController"]({linkService:this.pdfLinkService}),this.pdfViewer=new Ft["PDFViewer"]({container:e,linkService:this.pdfLinkService,findController:this.findController,l10n:this.l10n,useOnlyCssZoom:0,textLayerMode:1});const t=[{text:"Abstract",bgColor:"orange"}],i=[[{begin:{divIdx:21,offset:4},end:{divIdx:21,offset:16},bgColor:"yellow"},{begin:{divIdx:22,offset:32},end:{divIdx:23,offset:8},bgColor:"red"},{begin:{divIdx:24,offset:64},end:{divIdx:28,offset:32},bgColor:"blue"}]];this.pdfViewer.createTextLayerBuilder=function(e,r,n,s=!1){return new Rt({textLayerDiv:e,eventBus:this.eventBus,pageIndex:r,viewport:n,findController:this.isInPresentationMode?null:this.findController,enhanceTextSelection:!this.isInPresentationMode&&s,highlights:i[r]||[],highlightTexts:t||[]})},this.pdfLinkService.setViewer(this.pdfViewer),this.pdfHistory=new Ft["PDFHistory"]({linkService:this.pdfLinkService}),this.pdfLinkService.setHistory(this.pdfHistory)},open(e){return this.pdfLoadingTask?this.close().then(()=>{return this.open(e)}):(this.pdfLoadingTask=Qe.a.getDocument({url:e.url,maxImageSize:jt,cMapUrl:Mt,cMapPacked:Ut}),this.pdfLoadingTask.onProgress=e=>{this.progress(e.loaded/e.total)},this.pdfLoadingTask.promise.then(e=>{return this.pdfDocument=e,this.pdfViewer.setDocument(e),this.pdfLinkService.setDocument(e),this.pdfHistory.initialize({fingerprint:e.fingerprint}),this.loadingBar.hide(),this.pdfViewer.currentScaleValue=1.25,this.showOutline(e),this.findController.setDocument(e),this.findController._extractText(),e},e=>{let t,i=e&&e.message,r=this.l10n;t=e instanceof Qe.a.InvalidPDFException?r.get("invalid_file_error",null,"Invalid or corrupted PDF file."):e instanceof Qe.a.MissingPDFException?r.get("missing_file_error",null,"Missing PDF file."):e instanceof Qe.a.UnexpectedResponseException?r.get("unexpected_response_error",null,"Unexpected server response."):r.get("loading_error",null,"An error occurred while loading the PDF."),t.then(e=>{this.error(e,{message:i})}),this.loadingBar.hide()}))},close(){let e=document.getElementById("errorWrapper");if(e.setAttribute("hidden","true"),!this.pdfLoadingTask)return Promise.resolve();let t=this.pdfLoadingTask.destroy();return this.pdfLoadingTask=null,this.pdfDocument&&(this.pdfDocument=null,this.pdfViewer.setDocument(null),this.pdfLinkService.setDocument(null,null)),t},error:function(e,t){let i=this.l10n,r=[i.get("error_version_info",{version:Qe.a.version||"?",build:Qe.a.build||"?"},"PDF.js v{{version}} (build: {{build}})")];t&&(r.push(i.get("error_message",{message:t.message},"Message: {{message}}")),t.stack?r.push(i.get("error_stack",{stack:t.stack},"Stack: {{stack}}")):(t.filename&&r.push(i.get("error_file",{file:t.filename},"File: {{file}}")),t.lineNumber&&r.push(i.get("error_line",{line:t.lineNumber},"Line: {{line}}"))));let n=document.getElementById("errorWrapper"),s=document.getElementById("errorMessage"),a=document.getElementById("errorClose");n.removeAttribute("hidden"),s.textContent=e,a.onclick=function(){n.setAttribute("hidden","true")};let o=document.getElementById("errorMoreInfo"),l=document.getElementById("errorShowMore"),c=document.getElementById("errorShowLess");l.onclick=function(){o.removeAttribute("hidden"),l.setAttribute("hidden","true"),c.removeAttribute("hidden"),o.style.height=o.scrollHeight+"px"},c.onclick=function(){o.setAttribute("hidden","true"),l.removeAttribute("hidden"),c.setAttribute("hidden","true")},l.removeAttribute("hidden"),c.setAttribute("hidden","true"),Promise.all(r).then(function(e){o.value=e.join("\n")})},progress(e){let t=Math.round(100*e);(t>this.loadingBar.percent||isNaN(t))&&(this.loadingBar.percent=t)},zoomIn(e){let t=this.pdfViewer.currentScale;do{t=(t*Kt).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(Ht,t)}while(--e&&t<Ht);this.pdfViewer.currentScaleValue=t,this.highlightLayers[0].updateHighlights([{text:"P4",bgColor:"red"}])},zoomOut(e){let t=this.pdfViewer.currentScale;do{t=(t/Kt).toFixed(2),t=Math.floor(10*t)/10,t=Math.max($t,t)}while(--e&&t>$t);this.pdfViewer.currentScaleValue=t},loadFile(e){let t=e.target.files[0];if(t){let e=URL.createObjectURL(t);this.open({url:e})}},selectLocalFile(){const e=this.$refs.LocalPdfFile;e.click()},async showOutline(e){this.outline=await e.getOutline()}}},zt=Qt,Jt=(i("a012"),Object(l["a"])(zt,kt,_t,!1,null,null,null));Jt.exports;I()(Jt,{VApp:k["a"],VAppBar:Z["a"],VBtn:_["a"],VContainer:V["a"],VContent:T["a"],VFlex:Ne["a"],VIcon:K["a"],VNavigationDrawer:me["a"],VTab:ct["a"],VTabs:dt["a"]});var qt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("v-content",[i("v-app-bar",{attrs:{flat:"",app:"","clipped-left":"","clipped-right":"",color:"#EEE"}},[e.highlightTexts?i("v-tabs",{attrs:{centered:"","background-color":"#EEE","icons-and-text":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("v-tabs-slider"),i("v-tab",{attrs:{href:"#tab-1"}},[e._v("\n          Full Text\n          "),i("v-icon",[e._v("mdi-file")])],1),i("v-tab",{attrs:{href:"#tab-2"}},[e._v("\n          Focused\n          "),i("v-icon",[e._v("mdi-format-list-bulleted-square")])],1)],1):e._e()],1),i("v-container",{attrs:{fluid:""}},[i("PdfViewer",{ref:"PdfViewer",class:{hidden:"tab-1"!=e.tab},attrs:{pdfUrl:e.paperUrl,allowLocalFile:e.allowLocalFile,highlightTexts:e.highlightTexts},on:{pdfLoaded:e.onPdfLoaded}}),i("v-card",{staticClass:"pa-2",class:{hidden:"tab-2"!=e.tab},attrs:{flat:""}},[e._l(e.quotes,function(t,r){return[i("ul",{key:r,staticClass:"quotes"},[i("h3",[e._v(e._s(t.title))]),e._l(t.lines,function(t,r){return[i("li",{key:r},[e._v("\n              "+e._s(t)+"\n            ")])]})],2)]})],2)],1)],1),i("v-navigation-drawer",{staticClass:"pa-2",attrs:{clipped:"",app:"",width:"18%"}},[i("PaperOutline",{attrs:{outline:e.outline}})],1),i("v-navigation-drawer",{attrs:{clipped:"",app:"",right:"",width:"18%"},model:{value:e.navRight,callback:function(t){e.navRight=t},expression:"navRight"}},[i("KeywordList",{attrs:{terms:e.keywords,colors:e.hightlightColors},on:{highlight:e.highlightByKeywords,unhighlight:e.removeHighlights,updateHighlight:e.removeHighlights}})],1)],1)},Xt=[],Wt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{staticClass:"text-left pa-5",attrs:{flat:"",tile:""}},[i("v-switch",{staticClass:"ma-1",scopedSlots:e._u([{key:"label",fn:function(){return[e._v("\n      Auto Highlight By Keywords\n      ")]},proxy:!0}]),model:{value:e.autoHighlight,callback:function(t){e.autoHighlight=t},expression:"autoHighlight"}}),i("v-card-title",[e._v("\n    Topics / Keywords\n    "),i("v-icon",{staticClass:"ml-3",on:{click:function(t){e.editKeyword=!e.editKeyword}}},[e._v(e._s(e.keywordIcon))])],1),e.editKeyword?e._e():i("v-list",{attrs:{rounded:"",dense:""}},[i("v-list-item-group",{attrs:{color:e.selectedKeywordColor},model:{value:e.selectedKeyword,callback:function(t){e.selectedKeyword=t},expression:"selectedKeyword"}},e._l(e.keywords,function(t,r){return i("v-list-item",{key:r,attrs:{dense:""}},[e.autoHighlight?i("v-list-item-action",{staticClass:"mr-2"},[i("v-checkbox",{attrs:{color:t.color},on:{change:function(i){return e.updateHighlight(t)}},model:{value:t.active,callback:function(i){e.$set(t,"active",i)},expression:"keyword.active"}})],1):e._e(),i("v-list-item-content",{class:{"keywords-no-checkbox":!e.autoHighlight}},[e._v("\n          "+e._s(t.term)+"\n        ")])],1)}),1)],1),e.editKeyword?i("v-list",{attrs:{dense:""}},e._l(e.keywords,function(t,r){return i("v-list-item",{key:r,attrs:{dense:""}},[i("v-list-item-action",{staticClass:"mr-1"},[i("v-btn",{attrs:{icon:""}},[i("v-icon",{attrs:{color:t.color}},[e._v("mdi-square")])],1)],1),i("v-list-item-content",[i("v-text-field",{attrs:{color:t.color},model:{value:t.term,callback:function(i){e.$set(t,"term",i)},expression:"keyword.term"}})],1),i("v-list-item-action",[i("v-btn",{attrs:{icon:""},on:{click:function(i){return e.removeKeyword(t.term)}}},[i("v-icon",{attrs:{color:"grey lighten-1",title:"remove keyword"}},[e._v("\n            mdi-close-circle\n          ")])],1)],1)],1)}),1):e._e(),i("v-card-actions",[i("v-text-field",{staticClass:"mt-5",attrs:{label:"Add Keywords",items:e.suggestedTerms,flat:"",filled:"",rounded:"","append-icon":"mdi-plus"},on:{"click:append":e.addKeyword},model:{value:e.newKeywordTerm,callback:function(t){e.newKeywordTerm=t},expression:"newKeywordTerm"}})],1)],1)},Gt=[],Zt=i("7ee7"),Yt=i.n(Zt),ei=i("2dac"),ti=i.n(ei),ii=i("1c40"),ri=i.n(ii),ni={name:"KeywordList",props:{text:String,terms:Array,suggestedTerms:Array,highlighted:Boolean,colors:Array},data:()=>({keywords:[],newKeywordTerm:null,selectedKeyword:null,autoHighlight:!1,highlightInProcess:!1,editKeyword:!1}),computed:{selectedKeywordColor(){return Number.isInteger(this.selectedKeyword)&&!this.autoHighlight?this.keywords[this.selectedKeyword].color:"#FFFFFF"},keywordIcon(){return this.editKeyword?"mdi-check":"mdi-pencil"}},watch:{text(e){0===this.terms.length&&Yt()().use(ti.a).use(ri.a).process(e,this.extractKeywords)},terms(e){this.keywords=e.map((e,t)=>{return{term:e,color:this.colors[t]||"yellow",active:!0}})},highlighted(e){this.highlightInProcess=e},autoHighlight(e){e?(this.keywords.forEach(e=>e.active=!0),this.updateHighlight(),this.highlightInProcess=!0):(this.$emit("unhighlight"),this.highlightInProcess=!1),this.selectedKeyword=null},selectedKeyword(e){this.autoHighlight||(this.keywords.forEach(e=>e.active=!1),Number.isInteger(e)&&(this.keywords[e].active=!0),this.updateHighlight())},editKeyword(e){e||this.updateHighlight()}},methods:{extractKeywords(e,t){t.data.keyphrases.forEach(e=>{console.log(e.matches)})},addKeyword(){if(this.newKeywordTerm.length>2){let e=this.keywords.map(e=>e.color),t=this.colors.filter(t=>-1===e.indexOf(t))[0]||"yellow",i={term:this.newKeywordTerm,active:!0,color:t};this.keywords.push(i),this.updateHighlight(i),this.newKeywordTerm=""}},removeKeyword(e){this.keywords=this.keywords.filter(t=>t.term!==e),this.updateHighlight()},updateHighlight(e){void 0===e||e.active?this.$emit("highlight",this.keywords.filter(e=>e.active)):this.$emit("updateHighlight",e.term)}}},si=ni,ai=(i("0b03"),i("b73d")),oi=Object(l["a"])(si,Wt,Gt,!1,null,"0787166c",null),li=oi.exports;I()(oi,{VBtn:_["a"],VCard:L["a"],VCardActions:De["a"],VCardTitle:De["c"],VCheckbox:lt["a"],VIcon:K["a"],VList:$["a"],VListItem:H["a"],VListItemAction:ue["a"],VListItemContent:Q["b"],VListItemGroup:he["a"],VSwitch:ai["a"],VTextField:Oe["a"]});var ci=i("12a7"),di=i.n(ci),ui=i("06a1"),hi=i.n(ui);function pi(e,t={plurals:!0,parentheses:!0,possessives:!0,honorifics:!0}){let i=e.trim().replace(/\[[\d\w.]+\]/g,"").replace(/(:|;|\[|\]|\{|\}|"|'|- )/g,"");return di()(i).normalize(t).out()}function fi(e){let t=e.replace(/\d+\.*\d+/g,"").replace(/(\w+|\d+)(\.)/g,"$1").split(" ").filter(e=>e.length>=3);return hi.a.removeStopwords(t).map(e=>e.toLowerCase())}function gi(e){let t=e.length,i=[],r=e.map(e=>pi(e));for(let n of r){let e=fi(n);for(let n of e){let e=i.map(e=>e.word).indexOf(n);-1===e?i.push({word:n,tf:1,idf:Math.log10(t/(1+r.filter(e=>e.includes(n)).length))}):i[e].tf+=1}}for(const n of i)n.tfidf=n.tf*n.idf;return i}function vi({text:e,wordMetrics:t=null}){let i=e.split(". ").filter(e=>e.length>20).map((e,t)=>{return{docIdx:t,str:e.trim(),words:fi(pi(e))}}),r=t||gi(i.map(e=>e.str));for(let s of i){s.tfidf=0;let e=s.words.map(e=>s.words.filter(t=>t===e).length);s.words.length&&(s.tfidf=s.words.map((t,i)=>{let n=r.map(e=>e.word).indexOf(t),s=-1===n?0:r[n].idf;return e[i]*s}).reduce((e,t)=>e+t),s.tfidf/=s.words.length)}let n=i.filter(e=>e.words.length>5&&e.words.length<20&&!e.str.includes("{")&&!e.str.includes("}")).sort((e,t)=>t.tfidf-e.tfidf).sort((e,t)=>e.docIdx-t.docIdx);return n}var mi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-card",{attrs:{flat:""}},[e.pdfDocument?i("v-toolbar",{staticClass:"controls",attrs:{flat:"",dense:""}},[i("v-flex",{staticStyle:{margin:"auto"},attrs:{"justify-center":""}},[i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomOut()}}},[i("v-icon",{attrs:{color:"white"}},[e._v("mdi-magnify-minus-outline")])],1),i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.zoomIn()}}},[i("v-icon",{attrs:{color:"white"}},[e._v("mdi-magnify-plus-outline")])],1),i("v-btn",{attrs:{icon:"",disabled:e.pageNumber<2},on:{click:function(t){e.pageNumber-=1}}},[i("v-icon",{attrs:{color:"white"}},[e._v("mdi-chevron-left")])],1),i("input",{directives:[{name:"model",rawName:"v-model",value:e.pageNumber,expression:"pageNumber"}],staticClass:"page-number-input",attrs:{type:"text",value:"1",size:"2"},domProps:{value:e.pageNumber},on:{input:function(t){t.target.composing||(e.pageNumber=t.target.value)}}}),e._v(" / "+e._s(e.pageTotal)+"\n      "),i("v-btn",{attrs:{icon:"",disabled:e.pageNumber>=e.pageTotal},on:{click:function(t){e.pageNumber+=1}}},[i("v-icon",{attrs:{color:"white"}},[e._v("mdi-chevron-right")])],1)],1),e.allowLocalFile?i("v-btn",{attrs:{icon:""},on:{click:e.selectLocalFile}},[i("v-icon",{attrs:{color:"white"}},[e._v("mdi-file-upload")])],1):e._e()],1):e._e(),i("input",{ref:"LocalPdfFile",staticClass:"hidden",attrs:{type:"file"},on:{change:e.loadFile}}),e.allowLocalFile&&!e.pdfDocument?i("v-layout",{attrs:{"justify-center":"","ma-10":""}},[i("v-btn",{attrs:{color:"primary"},on:{click:e.selectLocalFile}},[i("v-icon",[e._v("mdi-file-upload")]),e._v(" Open Local File\n      ")],1)],1):e._e(),i("v-btn-toggle",{staticClass:"float-buttons",style:[e.floatButtonStyle],attrs:{id:"float-button"}},[i("v-btn",[i("v-icon",[e._v("mdi-format-align-left")])],1),i("v-btn",[i("v-icon",[e._v("mdi-format-align-center")])],1)],1),i("v-flex",[i("div",{ref:"viewerContainer",attrs:{id:"viewerContainer"}},[i("div",{ref:"pdfViewer",staticClass:"pdfViewer",attrs:{id:"viewer"}})]),i("div",{attrs:{id:"loadingBar"}},[i("div",{staticClass:"progress"}),i("div",{staticClass:"glimmer"})]),i("div",{attrs:{id:"errorWrapper",hidden:"true"}},[i("div",{attrs:{id:"errorMessageLeft"}},[i("span",{attrs:{id:"errorMessage"}}),i("button",{attrs:{id:"errorShowMore"}},[e._v("\n          More Information\n        ")]),i("button",{attrs:{id:"errorShowLess"}},[e._v("\n          Less Information\n        ")])]),i("div",{attrs:{id:"errorMessageRight"}},[i("button",{attrs:{id:"errorClose"}},[e._v("\n          Close\n        ")])]),i("div",{staticClass:"clearBoth"}),i("textarea",{attrs:{id:"errorMoreInfo",hidden:"true",readonly:"readonly"}})])])],1)},wi=[];Qe.a.GlobalWorkerOptions.workerSrc="../../node_modules/pdfjs-dist/build/pdf.worker.js";let bi=8388608,yi="../../node_modules/pdfjs-dist/cmaps/",xi=!0,Ci=1.1,Ii=.25,ki=10;var _i={name:"PDfViewer",props:{pdfUrl:String,highlightTexts:Array,allowLocalFile:Boolean},data:()=>({pdfLoadingTask:null,pdfDocument:null,pdfViewer:null,pdfHistory:null,pdfLinkService:null,pageNumber:1,floatButtonStyle:{left:0,top:0,display:"none"}}),computed:{pageTotal(){return this.pdfDocument?this.pdfDocument.numPages:1},loadingBar(){let e=new Ft["ProgressBar"]("#loadingBar",{});return Qe.a.shadow(this,"loadingBar",e)}},watch:{pageNumber(){"string"===typeof this.pageNumber&&(this.pageNumber=parseInt(this.pageNumber)),document.getElementsByClassName("page")[this.pageNumber-1].scrollIntoView()},pdfUrl(){this.open({url:this.pdfUrl})},highlightTexts(){this.pdfViewer.pagesPromise.then(()=>{for(let e=0;e<this.pageTotal;++e){const t=this.pdfViewer.getPageView(e);t.textLayer&&(t.textLayer.highlightTexts=this.highlightTexts,t.textLayer.updateHighlights())}})}},mounted(){this.l10n=Ft["NullL10n"];let e=this.$refs.viewerContainer;this.pdfLinkService=new Ft["PDFLinkService"],this.findController=new Et["PDFFindController"]({linkService:this.pdfLinkService}),this.pdfViewer=new Ft["PDFViewer"]({container:e,linkService:this.pdfLinkService,findController:this.findController,l10n:this.l10n,useOnlyCssZoom:0,textLayerMode:1}),this.pdfViewer.createTextLayerBuilder=(e,t,i,r=!1)=>{return new Rt({textLayerDiv:e,eventBus:this.pdfViewer.eventBus,pageIndex:t,viewport:i,findController:this.pdfViewer.isInPresentationMode?null:this.pdfViewer.findController,enhanceTextSelection:!this.pdfViewer.isInPresentationMode&&r,highlights:[],highlightTexts:this.highlightTexts||[]})},this.pdfLinkService.setViewer(this.pdfViewer),this.pdfHistory=new Ft["PDFHistory"]({linkService:this.pdfLinkService}),this.pdfLinkService.setHistory(this.pdfHistory),this.$refs.viewerContainer.addEventListener("click",e=>{this.floatButtonStyle.left=e.clientX+"px",this.floatButtonStyle.top=e.clientY+"px"})},methods:{open(e){return this.pdfLoadingTask?this.close().then(()=>{return this.open(e)}):(this.pdfLoadingTask=Qe.a.getDocument({url:e.url,maxImageSize:bi,cMapUrl:yi,cMapPacked:xi}),this.pdfLoadingTask.onProgress=e=>{this.progress(e.loaded/e.total)},this.pdfLoadingTask.promise.then(e=>{return this.pdfDocument=e,this.pdfViewer.setDocument(e),this.pdfLinkService.setDocument(e),this.pdfHistory.initialize({fingerprint:e.fingerprint}),this.loadingBar.hide(),this.pdfViewer.currentScaleValue=1.25,this.findController.setDocument(e),this.findController._extractText(),this.$emit("pdfLoaded",e),e},e=>{let t,i=e&&e.message,r=this.l10n;t=e instanceof Qe.a.InvalidPDFException?r.get("invalid_file_error",null,"Invalid or corrupted PDF file."):e instanceof Qe.a.MissingPDFException?r.get("missing_file_error",null,"Missing PDF file."):e instanceof Qe.a.UnexpectedResponseException?r.get("unexpected_response_error",null,"Unexpected server response."):r.get("loading_error",null,"An error occurred while loading the PDF."),t.then(e=>{this.error(e,{message:i})}),this.loadingBar.hide()}))},close(){let e=document.getElementById("errorWrapper");if(e.setAttribute("hidden","true"),!this.pdfLoadingTask)return Promise.resolve();let t=this.pdfLoadingTask.destroy();return this.pdfLoadingTask=null,this.pdfDocument&&(this.pdfDocument=null,this.pdfViewer.setDocument(null),this.pdfLinkService.setDocument(null,null)),t},error:function(e,t){let i=this.l10n,r=[i.get("error_version_info",{version:Qe.a.version||"?",build:Qe.a.build||"?"},"PDF.js v{{version}} (build: {{build}})")];t&&(r.push(i.get("error_message",{message:t.message},"Message: {{message}}")),t.stack?r.push(i.get("error_stack",{stack:t.stack},"Stack: {{stack}}")):(t.filename&&r.push(i.get("error_file",{file:t.filename},"File: {{file}}")),t.lineNumber&&r.push(i.get("error_line",{line:t.lineNumber},"Line: {{line}}"))));let n=document.getElementById("errorWrapper"),s=document.getElementById("errorMessage"),a=document.getElementById("errorClose");n.removeAttribute("hidden"),s.textContent=e,a.onclick=function(){n.setAttribute("hidden","true")};let o=document.getElementById("errorMoreInfo"),l=document.getElementById("errorShowMore"),c=document.getElementById("errorShowLess");l.onclick=function(){o.removeAttribute("hidden"),l.setAttribute("hidden","true"),c.removeAttribute("hidden"),o.style.height=o.scrollHeight+"px"},c.onclick=function(){o.setAttribute("hidden","true"),l.removeAttribute("hidden"),c.setAttribute("hidden","true")},l.removeAttribute("hidden"),c.setAttribute("hidden","true"),Promise.all(r).then(function(e){o.value=e.join("\n")})},progress(e){let t=Math.round(100*e);(t>this.loadingBar.percent||isNaN(t))&&(this.loadingBar.percent=t)},zoomIn(e){let t=this.pdfViewer.currentScale;do{t=(t*Ci).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(ki,t)}while(--e&&t<ki);this.pdfViewer.currentScaleValue=t},zoomOut(e){let t=this.pdfViewer.currentScale;do{t=(t/Ci).toFixed(2),t=Math.floor(10*t)/10,t=Math.max(Ii,t)}while(--e&&t>Ii);this.pdfViewer.currentScaleValue=t},loadFile(e){let t=e.target.files[0];if(t){let e=URL.createObjectURL(t);this.open({url:e})}},selectLocalFile(){const e=this.$refs.LocalPdfFile;e.click()}}},Li=_i,Ai=(i("c88d"),i("a5a0"),i("a609")),Vi=Object(l["a"])(Li,mi,wi,!1,null,"54676d95",null),Ti=Vi.exports;I()(Vi,{VBtn:_["a"],VBtnToggle:Ai["a"],VCard:L["a"],VFlex:Ne["a"],VIcon:K["a"],VLayout:ee["a"],VToolbar:ut["a"]});var Pi={name:"PaperReader",components:{PdfViewer:Ti,PaperOutline:Dt,KeywordList:li},data:()=>({user:null,collectionId:null,pdfDocument:null,paperId:null,paperUrl:null,outline:null,pdfTexts:null,navRight:!0,tab:"tab-1",quotes:null,keywords:[],highlightTexts:null,allowLocalFile:!1,hightlightColors:["purple","teal","orange","blue","green","pink","brown"]}),computed:{pageTotal(){return this.pdfDocument?this.pdfDocument.numPages:1}},created(){this.collectionId=this.$route.params.collectionId,this.paperId=this.$route.params.paperId},async mounted(){if(this.collectionId&&this.paperId){let t=await Ze(this.collectionId,this.paperId);try{this.paperUrl=t}catch(e){console.log(e)}}else this.allowLocalFile=!0},methods:{async onPdfLoaded(e){this.pdfDocument=e,this.outline=await e.getOutline(),this.pdfTexts=await this.getPaperTexts(),this.keywords=this.parseKeywords(this.pdfTexts[0])},async getPaperTexts(){let e="";for(let t=1;t<this.pageTotal;t++){let i=await this.pdfDocument.getPage(t),r=await i.getTextContent();e=e+"<br />"+r.items.map(e=>e.str).join("<br />")}if(null===this.outline)return[e];{let t=this.outline.map(e=>e.title);return this.textBySections(e,t)}},analyzeTextByKeywords(e){return this.pdfTexts.map(t=>{let i=t.split("."),r=new Array(i.length);return i.forEach((t,i)=>{let n={},s=t.toLowerCase().replace(/<br \/>/g," ").replace(/- /g,"");e.forEach(e=>{s.includes(e)?n[e]=1:n[e]=0;let t=e.split(" ");t.forEach(i=>{s.includes(i)&&(n[e]+=1/t.length)})});let a="other",o=0,l=0;e.forEach(e=>{n[e]>o&&(o=n[e],a=e),l+=n[e]}),s.match(/[\s+]\d+(.*|,*)[\d*]/g)&&(l*=2),r[i]={sentence:t,stats:n,topic:a,score:l,docIdx:i}}),r})},highlightByKeywords(e){let t=e.map(e=>e.term),i=this.analyzeTextByKeywords(t).map(e=>{let i=Math.min(Math.ceil(.1*e.length),5*t.length);return e.sort((e,t)=>t.score-e.score).slice(0,i).sort((e,t)=>e.docIdx-t.docIdx)}),r=this.outline?i.slice(1,-1):i;this.highlightTexts=[].concat(...r.map(i=>{return i.map(i=>{let r=t.indexOf(i.topic);return{bgColor:-1===r?"none":e[t.indexOf(i.topic)].color,text:i.sentence.replace(/<br \/>/g,"").trim(),topic:i.topic}}).filter(e=>-1!==t.indexOf(e.topic))})),this.createSummary(r)},removeHighlights(e){this.highlightTexts=void 0===e?[]:this.highlightTexts.filter(t=>t.topic!==e)},createSummary(e){let t=this.outline?this.outline.map(e=>e.title):["Summary"];this.quotes=e.map((e,i)=>{return{title:t[i],lines:e.map(e=>e.sentence.replace(/<br \/>/g," ").replace(/- /g,"").trim())}})},selectSentences(e){let t;if(null===this.outline)t=[vi({text:e[0]})];else{let i=e.slice(1),r=gi(i).sort((e,t)=>t.tfidf-e.tfidf).slice(0,20);t=i.map(e=>vi({text:e,metrics:r}))}return t},parseKeywords(e){let t=e.replace(/<br \/>/g," "),i=/(keywords|index terms)/gi.exec(t),r=t.search(/ntroduction/gi),n=t.slice(i.index+i[0].length,r),s=[];n.match(/(:|;|,)/g).forEach(e=>{let t=s.map(e=>e.char).indexOf(e);-1===t?s.push({char:e,count:1}):s[t].count++});let a=s.sort((e,t)=>t.count-e.count)[0].char,o=n.split(a).map(e=>e.trim().toLowerCase()).filter(e=>e.length>2).map(e=>pi(e.replace(/([^\w\d,\- ])/g,"").split(" ").filter(e=>e.trim().length>1).join(" ")));return o},textBySections(e,t){let i,r=t.length,n=[];for(let s=0;s<r;s++){let r=t[s].split(" ").map(e=>e.toUpperCase()),a=r.map(e=>{return e.split("").join("(<br \\/>)*")}).join("(<br \\/>)*"),o=new RegExp(""+a),l=e.match(o);l?(i=l.index+l[0].length,n.push(e.substring(0,i)),e=e.substring(i)):i=-1}return-1===i&&n.push(e),n}}},Si=Pi,Di=(i("c756"),i("9a96")),Fi=Object(l["a"])(Si,qt,Xt,!1,null,"80556a92",null),Ei=Fi.exports;I()(Fi,{VApp:k["a"],VAppBar:Z["a"],VCard:L["a"],VContainer:V["a"],VContent:T["a"],VIcon:K["a"],VNavigationDrawer:me["a"],VTab:ct["a"],VTabs:dt["a"],VTabsSlider:Di["a"]}),r["a"].use(u["a"]);let Ni=new u["a"]({mode:"history",base:"/paperlax-reader/",routes:[{path:"/",name:"Reader",component:Ei}]});Ni.beforeEach((e,t,i)=>{const r=e.matched.some(e=>e.meta.requireAuth);r?b(t=>{t?i():i("/auth/signin?redirect="+e.path)}):i()});var Oi=Ni,Bi=i("2f62");r["a"].use(Bi["a"]);var Ri=new Bi["a"].Store({state:{user:null,navigationDrawer:!1},mutations:{setUser(e,t){e.user=t},toggleNavigationDrawer(e){e.navigationDrawer=!e.navigationDrawer}},getters:{getUser:e=>()=>{return e.user}},actions:{authenticated({commit:e},t){e("setUser",t)}}}),ji=i("f309");r["a"].use(ji["a"]);var Mi=new ji["a"]({icons:{iconfont:"mdi"}});const Ui={apiKey:"AIzaSyAwAqNWiOQkgVjfjHewJb2smul8_2J2BYw",authDomain:"paperlax.firebaseapp.com",databaseURL:"https://paperlax.firebaseio.com",projectId:"paperlax",storageBucket:"paperlax.appspot.com",messagingSenderId:"307362375810",appId:"1:307362375810:web:b6f6806ca2becf45"};i("588e");r["a"].config.productionTip=!1,f["initializeApp"](Ui),new r["a"]({router:Oi,store:Ri,vuetify:Mi,render:e=>e(d)}).$mount("#app")},6:function(e,t){},7:function(e,t){},"726f":function(e,t,i){},7362:function(e,t,i){},"798f":function(e,t,i){},"7d05":function(e,t,i){},8:function(e,t){},"9b19":function(e,t,i){e.exports=i.p+"img/logo.63a7d78d.svg"},"9c89":function(e,t,i){},a012:function(e,t,i){"use strict";var r=i("7362"),n=i.n(r);n.a},a5a0:function(e,t,i){"use strict";var r=i("9c89"),n=i.n(r);n.a},a5cb:function(e,t,i){},b224:function(e,t,i){},bb91:function(e,t,i){"use strict";var r=i("d85e"),n=i.n(r);n.a},c756:function(e,t,i){"use strict";var r=i("ea2f"),n=i.n(r);n.a},c88d:function(e,t,i){"use strict";var r=i("ebb1"),n=i.n(r);n.a},c8d2:function(e,t,i){"use strict";var r=i("798f"),n=i.n(r);n.a},cebc:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAACi1BMVEVHcEyFtTn/ZQL/gACAv4D/qgD/wQj/SgH/aQNcsUonesW/v0D/fAD/wQeq/wD/wAf/gAD/XwJ5tD7/vwD/vwf/egSdtTBrkYqguS2HtTj/RQD/cQKHtjiCtDu2tiT/aQFlj4+GtTmLtDeAmnL/gACctzB7tT08grP/UQFZipr/SACjsTL/igT/gAB4sz//cAP/bgNYsUpQh6L/RgH/dwJjsUf/SgH/dAIpfMT/eAWAonSBtTv/wQe/vyD/aQNejpGLol1Vip6VtzL/XgL/aAP/nwD/WgGltTAwfb7/dQP/ZAJ7tT08gbT/TAFfskj/hQBesEpcsEqUuDKbty7/aQP/ZgKRtTX/dgWDtTlGhapPiKKVtjGmvyb/cgKPl2hasEtZsEtqlZVnskX/gwdnsUX/ZwL/XwJplYKZuytdjJgtfMFxk4T/awOdty+JtTeLtjeInHH/XQJXipuOtjX/jgCduieAn0D/gAB2skC/vyD/eAWZtTD/cwJukYf/egWuuSOqtistfMH/lgD/aQOHlnMpesOlvCaiuS7/UAGqqiv/ZAL/XAKVuSz/wQf/wwf/cQD/SwH/bQD/wAdbsUqTtjT/oAWEtDn/vweOqjn/cQP/wAb/wQeXtTD/wgb/igf/wAn/SQFdsUr/vwn/aAKyuSf/dQL/wQn/wQf/wQj/vQeHtDj/wQf//wD/cQP/wQj/vwncvhX/PQAZdtJMr1D/wQf/QABSsE1QsE5Nr1D/QQBgl39Rr04eeM5WjpIed81ZqlhgpmD/QgBRrlFNrlEgeMsfeMxin20ad9EtfMDSvRn/iAT/XQJdsUn/vwftvw6DtDr0wAz/RgGxuSf/swb/dgP/mQX+wQdlsUb/PgApwzeYAAAAsXRSTlMAz9AEBAPt/MD8/gQj+QPUBuTmDEhDYJYzxP6QzswHv8TPwyYKX+L399T9JD8U5KC1/ub+jvv9f/1iFtCtEMXkC9d/5cUI6jD8mc/m9/z7F/39nYq/zps40uzkghSIIP39DPcn99Lj3R7U/Zy4PM+1WujcswkaCBbnCGSKfLMwFkL8Ecwz/iIL+AbW5x2TJhv8B5L8nuj1JAmceq6OeSM5/f040yGSHeSI+dDjAsuHHPoXgeFNAAAB8klEQVRIx2NgGI6AucogrcPs4FYpDeccS2aCysPtfDciAXaXOrzKk1N3bkQDW5l4cKs3Md6IBWjF4lBe0rURB/ASwKa+qXAjTiCNRb2rG2718tgsWIxbfQg29UuRw7K5Rke3XNSciR3M5cCmft4ChHJPuBdV9NlxqGdYC1cv6I8sztONXf2ylVduQNSHshKVflZs2XL1Ith84tSzLt+yZcvl0xs3TugnLoHO3wICZ09tnUlkip61BQKmTiRSgw1UwyQksU0YgKsILskP1SCCV8MmdbgkG1TDdPwaLOCSvFANwvg1HCVVwz4MJ/Xh19BKqqd94JKzoRp68WuIgkvOhag/N20Gtlhy8IBqqIULLQKrP3lm8xRsGrJhNhTAhdas3rLl2qXtmzdP7sFUH5cFVd/IghBct+XC+c0gIMSNrp7FCGaBApLo+g3XN0OANZoOlkyY+j0tyOKrNsOAUCmyeEY6PIw0UQxashCugzOoDCbaHhZ4aC8srSqjWj1nx2aEFkWnhvqY3GhZTiDn8K7jYA3i6J7L24wLHDsCVO+IEXqdFTh1HDixKTIRM7xtvXHq2G9vhS1GKyN24NDAKIcjbwcnYFMeX427NNCW2YaufDdjG94CRELJFFm5n6Q7wTKHT6xYLSlg23bDFL18Vb5h2bIAABqWPo/k9EsKAAAAAElFTkSuQmCC"},d85e:function(e,t,i){},db71:function(e,t,i){"use strict";var r=i("2487"),n=i.n(r);n.a},ea2f:function(e,t,i){},ebb1:function(e,t,i){}});
//# sourceMappingURL=app.f4f48f07.js.map